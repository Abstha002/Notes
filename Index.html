<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AMOLED Note App</title>
  <style>
    :root {
      --bg: #000;
      --panel: #050505;
      --line: #111;
      --muted: #6b6b6b;
    }

    * { box-sizing: border-box; }
    body { margin: 0; background: var(--bg); color: white; font-family: sans-serif; }

    header {
      display: flex; justify-content: space-between; align-items: center;
      padding: 12px 16px; border-bottom: 1px solid var(--line);
      position: sticky; top: 0; background: #000;
    }

    #notesList {
      width: 320px; background: var(--panel); border-right: 1px solid var(--line);
      height: calc(100vh - 56px); overflow-y: auto; padding: 12px;
    }

    .note-row { background: transparent; padding: 10px; border-radius: 8px; margin-bottom: 8px; display:flex; justify-content:space-between; align-items:center }

    .note-left { display:flex; flex-direction:column; align-items:flex-start; gap:6px }
    .note-btn { background: none; border: none; color: white; text-align:left; cursor: pointer; font-size: 14px; padding:0 }
    .note-meta { font-size: 12px; color: var(--muted); }

    .icon-btn { background: #111; border: 1px solid #333; color: #fff; padding: 6px; border-radius: 6px; cursor: pointer; }
    .icon-btn.delete { color: #ff6b6b; }
    .icon-btn:hover { background: #222; }

    #editor { flex: 1; padding: 16px; display: flex; flex-direction: column; }

    #contentArea {
      flex: 1; background: black; color: white; border: 1px solid var(--line);
      border-radius: 8px; padding: 12px; resize: none; font-family: monospace;
    }

    #editorBar { margin-bottom: 10px; display: flex; gap: 8px; }
    #titleInput { flex: 1; padding: 8px; border-radius: 8px; background: #000; border: 1px solid var(--line); color: white; }

    .btn { padding: 8px 12px; background: #111; border: 1px solid var(--line); border-radius: 8px; color: white; cursor: pointer; }
    .btn:hover { background: #222; }

    #toast {
      position: fixed; bottom: 20px; right: 20px;
      background: #111; padding: 10px 14px; border-radius: 8px;
      display:none;
    }

    .container { display: flex; height: calc(100vh - 56px); }
    .empty{color:var(--muted); padding:12px}
  </style>
</head>
<body>

<header>
  <h2>Notes <sub>By Ab</sub></h2>
  <div>
    <button id="newBtn" class="btn">+ New</button>
    <button id="saveBtn" class="btn">Save</button>
    <button id="deleteBtn" class="btn">Delete</button>
  </div>
</header>

<div class="container">
  <aside id="notesList"></aside>

  <main id="editor">
    <div id="editorBar">
      <input id="titleInput" placeholder="Title" />
    </div>
    <textarea id="contentArea" placeholder="Write here..."></textarea>
  </main>
</div>

<div id="toast"></div>

<script>
(function(){
  // Safe, self-contained module to avoid global leakage
  const el = id => document.getElementById(id);
  const showToast = (msg) => {
    const t = el('toast');
    t.textContent = msg; t.style.display = 'block';
    clearTimeout(window._toastTimer);
    window._toastTimer = setTimeout(() => t.style.display = 'none', 1200);
  };

  let currentNote = null;

  function loadNotes(){
    const notes = JSON.parse(localStorage.getItem('notes') || '{}');
    const list = el('notesList');
    list.innerHTML = '';

    const ids = Object.keys(notes).sort((a,b)=> Number(b) - Number(a));
    if(ids.length === 0){
      const e = document.createElement('div'); e.className = 'empty'; e.textContent = 'No notes yet â€” click + New to create one.'; list.appendChild(e); return;
    }

    ids.forEach(id => {
      const row = document.createElement('div'); row.className = 'note-row';

      const left = document.createElement('div'); left.className = 'note-left';
      const btn = document.createElement('button'); btn.className = 'note-btn';
      // Use safe split with escaped newline
      const preview = (notes[id].content || '').split('\n')[0] || '';
      btn.textContent = notes[id].title && notes[id].title !== 'Untitled' ? notes[id].title : (preview || 'Untitled');
      btn.addEventListener('click', () => openNote(id));

      const meta = document.createElement('div'); meta.className = 'note-meta'; meta.textContent = notes[id].date || '';
      left.appendChild(btn); left.appendChild(meta);

      const actions = document.createElement('div');
      const del = document.createElement('button'); del.className = 'icon-btn delete'; del.title = 'Delete'; del.innerText = 'ðŸ—‘';
      // Stop propagation and confirm
      del.addEventListener('click', (e) => { e.stopPropagation(); handleDelete(id); });

      actions.appendChild(del);
      row.appendChild(left); row.appendChild(actions);
      list.appendChild(row);
    });
  }

  function createNote(){
    const notes = JSON.parse(localStorage.getItem('notes') || '{}');
    const id = Date.now().toString();
    notes[id] = { title: 'Untitled', content: '', date: new Date().toLocaleString() };
    localStorage.setItem('notes', JSON.stringify(notes));
    currentNote = id;
    openNote(id);
    loadNotes();
    showToast('New note created');
  }

  function openNote(id){
    const notes = JSON.parse(localStorage.getItem('notes') || '{}');
    if(!notes[id]){ showToast('Note not found'); return; }
    currentNote = id;
    el('titleInput').value = notes[id].title || '';
    el('contentArea').value = notes[id].content || '';
  }

  function saveNote(){
    if(!currentNote){ showToast('No note selected'); return; }
    const notes = JSON.parse(localStorage.getItem('notes') || '{}');
    const title = el('titleInput').value.trim();
    const content = el('contentArea').value;
    const autoTitle = (content.split('\n')[0] || '').trim() || 'Untitled';
    notes[currentNote] = { title: title || autoTitle, content: content, date: new Date().toLocaleString() };
    localStorage.setItem('notes', JSON.stringify(notes));
    loadNotes();
    showToast('Saved');
  }

  function handleDelete(id){
    if(!confirm('Delete this note?')) return;
    const notes = JSON.parse(localStorage.getItem('notes') || '{}');
    if(!notes[id]){ showToast('Note not found'); return; }
    const { [id]: _, ...rest } = notes;
    localStorage.setItem('notes', JSON.stringify(rest));
    if(currentNote === id){
      currentNote = null;
      el('titleInput').value = '';
      el('contentArea').value = '';
    }
    loadNotes();
    showToast('Deleted');
  }

  // Attach UI handlers safely by resolving elements first
  const newBtn = el('newBtn');
  const saveBtn = el('saveBtn');
  const deleteBtn = el('deleteBtn');

  newBtn && newBtn.addEventListener('click', createNote);
  saveBtn && saveBtn.addEventListener('click', saveNote);
  deleteBtn && deleteBtn.addEventListener('click', () => { if(currentNote) handleDelete(currentNote); else showToast('No note selected'); });

  // Keyboard shortcut: Ctrl/Cmd+S
  window.addEventListener('keydown', (e) => {
    if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's'){
      e.preventDefault(); saveNote();
    }
  });

  // Initialize
  loadNotes();
})();
</script>

</body>
</html>
